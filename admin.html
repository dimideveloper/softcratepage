<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Softcrate</title>
    <meta name="robots" content="noindex, nofollow">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-gray-50">
    <div class="min-h-screen p-8">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-4xl font-bold mb-8">üîë Softcrate Admin Dashboard</h1>

            <!-- Login -->
            <div id="login-section" class="bg-white rounded-lg shadow p-8 mb-8">
                <h2 class="text-2xl font-bold mb-4">Login</h2>
                <input type="password" id="admin-password" placeholder="Admin Password"
                    class="border p-3 rounded w-full mb-4">
                <button onclick="login()"
                    class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700">Login</button>
            </div>

            <!-- Dashboard (hidden until login) -->
            <div id="dashboard" class="hidden">
                <!-- Add Keys -->
                <div class="bg-white rounded-lg shadow p-8 mb-8">
                    <h2 class="text-2xl font-bold mb-4">üì¶ Keys hinzuf√ºgen</h2>
                    <select id="product-select" class="border p-3 rounded w-full mb-4">
                        <option value="windows-11-pro">Windows 11 Pro</option>
                        <option value="office-2024-ltsc">Office 2024 LTSC</option>
                        <option value="capcut-pro">CapCut Pro</option>
                    </select>
                    <textarea id="keys-input" placeholder="Keys (einer pro Zeile)"
                        class="border p-3 rounded w-full h-32 mb-4"></textarea>
                    <button onclick="addKeys()"
                        class="bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700">Keys hinzuf√ºgen</button>
                    <div id="add-result" class="mt-4"></div>
                </div>

                <!-- View Keys -->
                <div class="bg-white rounded-lg shadow p-8 mb-8">
                    <h2 class="text-2xl font-bold mb-4">üìä Verf√ºgbare Keys</h2>
                    <button onclick="viewKeys()"
                        class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 mb-4">Keys anzeigen</button>
                    <div id="keys-display"></div>
                </div>

                <!-- View Orders -->
                <div class="bg-white rounded-lg shadow p-8">
                    <h2 class="text-2xl font-bold mb-4">üìã Bestellungen</h2>
                    <button onclick="viewOrders()"
                        class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 mb-4">Bestellungen
                        anzeigen</button>
                    <div id="orders-display"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let password = '';

        function login() {
            password = document.getElementById('admin-password').value;
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
        }

        async function addKeys() {
            const product = document.getElementById('product-select').value;
            const keysText = document.getElementById('keys-input').value;
            const keys = keysText.split('\n').filter(k => k.trim());

            const response = await fetch('/api/admin/add-keys', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password, product, keys })
            });

            const result = await response.json();
            document.getElementById('add-result').innerHTML = response.ok
                ? `<div class="text-green-600">‚úÖ ${result.added} Keys hinzugef√ºgt! Total: ${result.total}</div>`
                : `<div class="text-red-600">‚ùå Fehler: ${result.error}</div>`;

            document.getElementById('keys-input').value = '';
        }

        async function viewKeys() {
            const response = await fetch('/api/admin/view-keys', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
            });

            const inventory = await response.json();
            let html = '<div class="grid grid-cols-1 md:grid-cols-3 gap-4">';

            for (const [product, data] of Object.entries(inventory)) {
                html += `
                    <div class="border p-4 rounded">
                        <h3 class="font-bold mb-2">${product}</h3>
                        <p class="text-2xl font-bold text-blue-600">${data.available} verf√ºgbar</p>
                    </div>
                `;
            }
            html += '</div>';
            document.getElementById('keys-display').innerHTML = html;
        }

        async function viewOrders() {
            const response = await fetch('/api/admin/view-orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
            });

            const data = await response.json();
            let html = `<p class="mb-4 font-bold">Total: ${data.total} Bestellungen</p>`;
            html += '<div class="overflow-x-auto"><table class="w-full border-collapse border">';
            html += '<thead><tr class="bg-gray-100"><th class="border p-2">Datum</th><th class="border p-2">E-Mail</th><th class="border p-2">Produkt</th><th class="border p-2">Key</th><th class="border p-2">Betrag</th></tr></thead><tbody>';

            data.orders.forEach(order => {
                const date = new Date(order.timestamp).toLocaleString('de-DE');
                html += `
                    <tr>
                        <td class="border p-2">${date}</td>
                        <td class="border p-2">${order.email}</td>
                        <td class="border p-2">${order.product}</td>
                        <td class="border p-2 font-mono text-sm">${order.license_key}</td>
                        <td class="border p-2">${order.amount} ${order.currency}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            document.getElementById('orders-display').innerHTML = html;
        }
    </script>
</body>

</html>